<?php
/**
 * –¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ leads
 */

require_once __DIR__ . '/models/Lead.php';

echo "<h1>üß™ –¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ leads</h1>";

try {
    $lead = new Lead();
    
    if (!$lead->testConnection()) {
        echo "‚ùå –ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö";
        exit;
    }
    
    echo "‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —É—Å–ø–µ—à–Ω–æ!<br><br>";
    
    // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
    $testData = [
        'name' => '–¢–µ—Å—Ç –î—É–±–ª–∏–∫–∞—Ç',
        'phone' => '+7 (999) 123-45-67',
        'email' => 'duplicate@test.com',
        'company' => '–¢–µ—Å—Ç–æ–≤–∞—è –∫–æ–º–ø–∞–Ω–∏—è',
        'message' => '–¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤'
    ];
    
    echo "<h3>üìù –¢–µ—Å—Ç 1: –ü–µ—Ä–≤–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞</h3>";
    $result1 = $lead->save($testData, '–¢–µ—Å—Ç–æ–≤–∞—è —É—Å–ª—É–≥–∞');
    echo "–†–µ–∑—É–ª—å—Ç–∞—Ç: " . ($result1 ? "‚úÖ –£—Å–ø–µ—à–Ω–æ" : "‚ùå –û—à–∏–±–∫–∞") . "<br>";
    
    echo "<h3>üìù –¢–µ—Å—Ç 2: –í—Ç–æ—Ä–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ –∫–∞–∫ –¥—É–±–ª–∏–∫–∞—Ç)</h3>";
    $result2 = $lead->save($testData, '–¢–µ—Å—Ç–æ–≤–∞—è —É—Å–ª—É–≥–∞');
    echo "–†–µ–∑—É–ª—å—Ç–∞—Ç: " . ($result2 ? "‚úÖ –£—Å–ø–µ—à–Ω–æ (–¥—É–±–ª–∏–∫–∞—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω)" : "‚ùå –û—à–∏–±–∫–∞") . "<br>";
    
    echo "<h3>üìù –¢–µ—Å—Ç 3: –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ 6 –º–∏–Ω—É—Ç (–¥–æ–ª–∂–Ω–∞ –ø—Ä–æ–π—Ç–∏)</h3>";
    echo "–ñ–¥–µ–º 6 —Å–µ–∫—É–Ω–¥...<br>";
    sleep(6);
    
    $result3 = $lead->save($testData, '–¢–µ—Å—Ç–æ–≤–∞—è —É—Å–ª—É–≥–∞');
    echo "–†–µ–∑—É–ª—å—Ç–∞—Ç: " . ($result3 ? "‚úÖ –£—Å–ø–µ—à–Ω–æ" : "‚ùå –û—à–∏–±–∫–∞") . "<br>";
    
    echo "<h3>üìä –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –≤ –±–∞–∑–µ:</h3>";
    $allLeads = $lead->getAll();
    if ($allLeads !== false) {
        echo "–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π: " . count($allLeads) . "<br>";
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –∑–∞–ø–∏—Å–µ–π
        echo "<h4>–ü–æ—Å–ª–µ–¥–Ω–∏–µ 5 –∑–∞–ø–∏—Å–µ–π:</h4>";
        $recentLeads = array_slice($allLeads, 0, 5);
        foreach ($recentLeads as $index => $record) {
            echo ($index + 1) . ". {$record['name']} - {$record['email']} - {$record['date_created']}<br>";
        }
    }
    
} catch (Exception $e) {
    echo "‚ùå –û—à–∏–±–∫–∞: " . $e->getMessage();
}
?>


<?php
/**
 * –¢–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ leads
 */

// –í–∫–ª—é—á–∞–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
error_reporting(E_ALL);
ini_set('display_errors', 1);

echo "<h1>üß™ –¢–µ—Å—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ leads</h1>";

// –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
echo "<h2>1. –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö</h2>";
require_once __DIR__ . '/config/database.php';

if (testDbConnection()) {
    echo "‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —É—Å–ø–µ—à–Ω–æ!<br>";
} else {
    echo "‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö<br>";
    exit;
}

// –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–ª–∞—Å—Å Lead
echo "<h2>2. –¢–µ—Å—Ç –∫–ª–∞—Å—Å–∞ Lead</h2>";
require_once __DIR__ . '/models/Lead.php';

try {
    $lead = new Lead();
    echo "‚úÖ –ö–ª–∞—Å—Å Lead —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ<br>";
    
    if ($lead->testConnection()) {
        echo "‚úÖ –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —á–µ—Ä–µ–∑ –∫–ª–∞—Å—Å Lead –ø—Ä–æ—à–µ–ª<br>";
    } else {
        echo "‚ùå –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —á–µ—Ä–µ–∑ –∫–ª–∞—Å—Å Lead –Ω–µ –ø—Ä–æ—à–µ–ª<br>";
    }
} catch (Exception $e) {
    echo "‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∞—Å—Å–∞ Lead: " . $e->getMessage() . "<br>";
}

// –¢–µ—Å—Ç–∏—Ä—É–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ lead
echo "<h2>3. –¢–µ—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è lead</h2>";
$testData = [
    'name' => '–¢–µ—Å—Ç –¢–µ—Å—Ç–æ–≤–∏—á',
    'phone' => '+7 (999) 123-45-67',
    'email' => 'test@example.com',
    'company' => '–¢–µ—Å—Ç–æ–≤–∞—è –∫–æ–º–ø–∞–Ω–∏—è',
    'message' => '–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ leads',
    'service' => '–¢–µ—Å—Ç–æ–≤–∞—è —É—Å–ª—É–≥–∞'
];

try {
    $result = saveLeadToDatabase($testData, '–¢–µ—Å—Ç–æ–≤–∞—è —É—Å–ª—É–≥–∞');
    if ($result) {
        echo "‚úÖ –¢–µ—Å—Ç–æ–≤—ã–π lead —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö!<br>";
    } else {
        echo "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π lead<br>";
    }
} catch (Exception $e) {
    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ lead: " . $e->getMessage() . "<br>";
}

// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
echo "<h2>4. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ leads</h2>";
try {
    $stats = $lead->getStats();
    if ($stats) {
        echo "üìä –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ leads: " . $stats['total'] . "<br>";
        
        if (!empty($stats['by_service'])) {
            echo "üìà –ü–æ —É—Å–ª—É–≥–∞–º:<br>";
            foreach ($stats['by_service'] as $service) {
                echo "&nbsp;&nbsp;‚Ä¢ " . htmlspecialchars($service['service']) . ": " . $service['count'] . "<br>";
            }
        }
        
        if (!empty($stats['by_date'])) {
            echo "üìÖ –ü–æ –¥–Ω—è–º (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π):<br>";
            foreach (array_slice($stats['by_date'], 0, 10) as $date) {
                echo "&nbsp;&nbsp;‚Ä¢ " . $date['date'] . ": " . $date['count'] . "<br>";
            }
        }
    } else {
        echo "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É<br>";
    }
} catch (Exception $e) {
    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: " . $e->getMessage() . "<br>";
}

echo "<hr>";
echo "<p><strong>–¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω!</strong></p>";
echo "<p>–ï—Å–ª–∏ –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ, —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å leads —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.</p>";
?>
